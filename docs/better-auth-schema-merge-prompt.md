# Better Auth Schema Merge Prompt

This prompt helps safely merge changes from the auto-generated `auth-schema.ts` into our controlled `lib/db/schema.auth.ts` with proper `ba_` prefixes.

## Context

- **Source file**: `auth-schema.ts` (auto-generated by Better Auth, no prefixes)
- **Target file**: `lib/db/schema.auth.ts` (our controlled version with `ba_` prefixes)
- **Purpose**: Keep our schema in sync with Better Auth updates while maintaining prefix consistency

## Instructions for LLM

When Better Auth regenerates `auth-schema.ts`, use this process to merge changes:

### 1. Compare Files
- Read both `auth-schema.ts` and `lib/db/schema.auth.ts`
- Identify new tables, fields, or modifications in `auth-schema.ts`
- Note any removed tables or fields

### 2. Apply Prefix Rules
For each table in `auth-schema.ts`, apply these transformations to `lib/db/schema.auth.ts`:

#### Table Names
- `"user"` → `"ba_users"`
- `"session"` → `"ba_sessions"`
- `"account"` → `"ba_accounts"`
- `"verification"` → `"ba_verifications"`
- `"sso_provider"` → `"ba_sso_providers"`
- `"jwks"` → `"ba_jwkss"`
- `"organization"` → `"ba_organizations"`
- `"member"` → `"ba_members"`
- `"invitation"` → `"ba_invitations"`
- `"apikey"` → `"ba_apikeys"`
- `"two_factor"` → `"ba_two_factors"`

#### Export Names
Keep both prefixed and original export names:
```typescript
// Prefixed table definitions
export const users = pgTable("ba_users", { ... });

// Original names for backward compatibility
export const user = users;
```

### 3. Preserve References
- Update all foreign key references to use the prefixed table variables
- Example: `.references(() => user.id)` → `.references(() => users.id)`

### 4. Verification Steps
- Ensure all imports from `drizzle-orm/pg-core` are preserved
- Verify all foreign key relationships point to correct prefixed tables
- Check that both prefixed and original export names exist
- Confirm no hardcoded table names without `ba_` prefix

### 5. Testing
After merge, verify:
```bash
# Build should pass
pnpm build

# Type checking should pass
npx tsc --noEmit
```

## Example Transformation

**From auth-schema.ts:**
```typescript
export const user = pgTable("user", {
  id: text("id").primaryKey(),
  email: text("email").notNull().unique(),
});

export const session = pgTable("session", {
  userId: text("user_id").references(() => user.id),
});
```

**To lib/db/schema.auth.ts:**
```typescript
export const users = pgTable("ba_users", {
  id: text("id").primaryKey(),
  email: text("email").notNull().unique(),
});

export const sessions = pgTable("ba_sessions", {
  userId: text("user_id").references(() => users.id),
});

// Backward compatibility exports
export const user = users;
export const session = sessions;
```

## Safety Notes

- Always backup `lib/db/schema.auth.ts` before making changes
- Test the merge in a separate branch first
- Verify database migrations work correctly after schema changes
- The master schema (`lib/db/schema.ts`) re-exports from this file, so changes propagate automatically